<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Loan Portfolio Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .flex-container { display: flex; gap: 30px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
    th { background-color: #f4f4f4; }
    .sidebar { min-width: 300px; }
    canvas { max-width: 100%; }
  </style>
</head>
<body>
  <h1>Loan Portfolio Monitoring Tool</h1>

  <!-- Dropdown to select loans -->
  <label for="loanSelect">Select Loan:</label>
  <select id="loanSelect">
    <option value="">--Choose--</option>
  </select>

  <div class="flex-container">
    <!-- Table container -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Week</th>
            <th>Cash Inflow</th>
            <th>Cash Outflow</th>
            <th>Fee Payment</th>
            <th>Tax Payment</th>
            <th>Available for Investment</th>
            <th>Already Invested</th>
          </tr>
        </thead>
        <tbody id="cashflowBody">
          <!-- Data dynamically populated -->
        </tbody>
      </table>
    </div>

    <!-- Sidebar for charts and metrics -->
    <div class="sidebar">
      <canvas id="regionPie"></canvas>
      <canvas id="providerPie"></canvas>

      <h3>Portfolio Stats</h3>
      <ul>
        <li><strong>Current Assets:</strong> $25,000,000</li>
        <li><strong>Holdings:</strong> 30 Loans</li>
        <li><strong>Weighted LVR:</strong> 65%</li>
        <li><strong>Avg Duration:</strong> 4.2 years</li>
        <li><strong>Portfolio Yield:</strong> 7.1%</li>
      </ul>
    </div>
  </div>

  <script>
    // Populate dropdown with 100 dummy loans
    const loanSelect = document.getElementById("loanSelect");
    for (let i = 1; i <= 100; i++) {
      const opt = document.createElement("option");
      opt.value = `Loan${i}`;
      opt.textContent = `Loan ${i}`;
      loanSelect.appendChild(opt);
    }

    // Dummy cashflow table data for 156 weeks
    const cashflowBody = document.getElementById("cashflowBody");
    for (let w = 1; w <= 156; w++) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>Week ${w}</td>
        <td>${(Math.random() * 10000).toFixed(2)}</td>
        <td>${(Math.random() * 8000).toFixed(2)}</td>
        <td>${(Math.random() * 1000).toFixed(2)}</td>
        <td>${(Math.random() * 1200).toFixed(2)}</td>
        <td>${(Math.random() * 15000).toFixed(2)}</td>
        <td>${(Math.random() * 10000).toFixed(2)}</td>
      `;
      cashflowBody.appendChild(row);
    }

    // Dummy pie chart data
    const regionCtx = document.getElementById('regionPie');
    new Chart(regionCtx, {
      type: 'pie',
      data: {
        labels: ['NSW', 'VIC', 'QLD', 'WA', 'SA', 'TAS'],
        datasets: [{
          data: [30, 25, 20, 10, 10, 5],
          backgroundColor: ['#4caf50', '#2196f3', '#ff9800', '#9c27b0', '#f44336', '#00bcd4']
        }]
      },
      options: {
        responsive: true,
        plugins: { title: { display: true, text: 'Regional Exposure' } }
      }
    });

    const providerCtx = document.getElementById('providerPie');
    new Chart(providerCtx, {
      type: 'pie',
      data: {
        labels: ['Provider A', 'Provider B', 'Provider C', 'Provider D'],
        datasets: [{
          data: [40, 30, 20, 10],
          backgroundColor: ['#3f51b5', '#009688', '#e91e63', '#ffc107']
        }]
      },
      options: {
        responsive: true,
        plugins: { title: { display: true, text: 'Provider Exposure' } }
      }
    });
  </script>
</body>
</html>
